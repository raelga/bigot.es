imports:
  - path: ../../templates/container/kubernetes-cluster.jinja
  - path: ../../templates/network/firewall-rule.jinja

resources:
  - name: kubernetes-cluster
    type: ../../templates/container/kubernetes-cluster.jinja
    properties:
      name: bonnie
      description: Bonnie MacFarlane Kubernetes Engine cluster.
      type: LOCAL
      network:
        subnet: kubernetes-sn
        location: europe-west1-b
      nodePools:
        - name: addons-pf-f1m
          preemptible: true
          autoscaling: false
          taints:
            - key: CriticalAddonsOnly
              effect: PREFER_NO_SCHEDULE
        - name: edge-rf-f1m
          preemptible: false
          autoscaling: false
          tags:
            - gke-bonnie-external-ip
          taints:
            - key: FailbackOnly
              effect: NO_EXECUTE

  - name: gke-traefik-fw-rule
    type: ../../templates/network/firewall-rule.jinja
    properties:
      name: gke-bonnie-traefik-all
      targetTags:
        - gke-bonnie-external-ip

outputs:
  - name: cluster-name
    value: $(ref.kubernetes-cluster.name)
  - name: cluster-endpoint
    value: $(ref.kubernetes-cluster.endpoint)
  - name: cluster-nodes-sa
    value: $(ref.kubernetes-cluster.nodes-sa)
